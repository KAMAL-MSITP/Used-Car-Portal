<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Used Car Portal</title>   
    <link rel="stylesheet" href="styles.css">  

    <script>
        async function fetchItems() {
        try {
            const response = await fetch('/usedcardetails');
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const data = await response.json();
            console.log(data);
            const carList = document.getElementById('carList');
         
            const makeDropdown = document.getElementById('Make');
            const locationDropdown = document.getElementById('StateOfRegistration');
            const modelDropdown = document.getElementById('Model');       
            
            const priceDropdown = document.getElementById('Price');     
            const buildyearDropdown = document.getElementById('BuildYear');       
            const kilometersDrivenDropdown = document.getElementById('KilometersDriven');       
            const descriptionDropdown = document.getElementById('description');
                       
             // Clear existing content
            carList.innerHTML = ''; 
            if (data && data.length > 0) {
                data.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'car-details'; // Add class for styling
                    li.innerHTML = `
                        <h2>${item.Make}</h2>
                        <p>Model: ${item.Model}</p>                        
                      
                        <p>Price: $${item.Price}</p>
                        <p>BuildYear: ${item.BuildYear}</p>
                        <p>KilometersDriven: ${item.KilometersDriven}</p>
                        <p>StateOfRegistration: ${item.StateOfRegistration}</p>
                        <p>Description: ${item.Description}</p>
                    `;
                    carList.appendChild(li);
                    const optionMake = document.createElement('option');
                    optionMake.value = `${item.Make}`;
                    optionMake.textContent = `${item.Make}`;
                    makeDropdown.appendChild(optionMake);

                    const optionLocation = document.createElement('option');
                    optionLocation.value = `${item.StateOfRegistration}`;
                    optionLocation.textContent = `${item.StateOfRegistration}`;
                    locationDropdown.appendChild(optionLocation);

                    const optionModel = document.createElement('option');
                    optionModel.value = `${item.Model}`;
                    optionModel.textContent = `${item.Model}`;
                    modelDropdown.appendChild(optionModel);

                   
                     
                    const optionPrice = document.createElement('option');
                    optionPrice.value = `${item.Price}`;
                    optionPrice.textContent = `${item.Price}`;
                    priceDropdown.appendChild(optionPrice);
              
                    const optionBuildyear = document.createElement('option');
                    optionBuildyear.value = `${item.BuildYear}`;
                    optionBuildyear.textContent = `${item.BuildYear}`;
                    buildyearDropdown.appendChild(optionBuildyear);

                    const optionKilometersDriven = document.createElement('option');
                    optionKilometersDriven.value = `${item.KilometersDriven}`;
                    optionKilometersDriven.textContent = `${item.KilometersDriven}`;
                    kilometersDrivenDropdown.appendChild(optionKilometersDriven);
             
                  
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'No items found'; // Display a message if no items are available
                carList.appendChild(li);
            }
        } catch (error) {
            console.error('Error fetching data:', error);
            const carList = document.getElementById('carList');
            carList.innerHTML = ''; // Clear existing content
            const li = document.createElement('li');
            li.textContent = 'Error fetching data'; // Display an error message if data fetching fails
            carList.appendChild(li);
        }
    }
    function getSelectedValues() {
        const selectedValues = {};
    const selects = document.querySelectorAll('select');
    console.log(selects);
    selects.forEach(select => {
        console.log(select.id)
        console.log(select.value)
        selectedValues[select.id] = select.value;
       
    });
    return selectedValues;
}
    function applyFilter() {
        
        const selectedValues = getSelectedValues();
    console.log("Selected values:", selectedValues);
    const convertedValues = {
    ...selectedValues,
    Price: parseInt(selectedValues.Price),
    BuildYear:parseInt(selectedValues.BuildYear),
    KilometersDriven: parseInt(selectedValues.KilometersDriven),
    
};
    // Send the selected values to the backend using AJAX
    fetch('/filterData', {
        method: 'Post',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(convertedValues),
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        // Handle the response from the backend
        console.log('Response from backend:', data);
        // Do something with the response data
        const carList = document.getElementById('carList');
        carList.innerHTML = ''; 
                data.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'car-details'; // Add class for styling
                    li.innerHTML = `
                        <h2>${item.Make}</h2>
                        <p>Model: ${item.Model}</p>                        
                      
                        <p>Price: $${item.Price}</p>
                        <p>BuildYear: ${item.BuildYear}</p>
                        <p>KilometersDriven: ${item.KilometersDriven}</p>
                        <p>StateOfRegistration: ${item.StateOfRegistration}</p>
                        <p>Description: ${item.Description}</p>
                    `;
                    carList.appendChild(li);
                });
    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
    });


}
function clearFilter(){
    fetchItems();
}
document.addEventListener("DOMContentLoaded", function() {
    // This function will be called once the DOM is fully loaded
    // Now you can safely add the event listener
    document.getElementById('applyButton').addEventListener('click', applyFilter);
    document.getElementById('ClearButton').addEventListener('click', clearFilter);
});

        fetchItems();
    </script>
</head>
<body>
    <header>

        <div>
            <img src="carlogo.jpg" alt="Homepage Car Logo" width="74px" height="46px">
            
            <h1>Used Car Portal</h1></div>
        <div>
            
            <nav>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="buycar.html">Buy Car</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                    <li><a href="Seller.html">Sell a Car</a></li>
                    <li><a href="mylist.html">My List</a></li>
                    <li><a href="mechanic.html">Mechanic</a></li>
                    <li><a href="howitworks.html">How it Works</a></li>
                    <li><a href="rentacar.html">Rent a Car</a></li>
                    <li><a href="contactus.html">Contact Us</a></li>
                    <li><a href="login.html">LOGIN</a></li>                                              
                        
                    </section>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        


        <div id="filterContainer">
          <form id="filterForm">
            <label for="make">Make:</label>
            <select id="Make" name="Make"></select>
            <label for="location">Location:</label>
            <select id="StateOfRegistration" name="StateOfRegistration"></select>
            <label for="model">Model:</label>
            <select id="Model" name="Model"></select>                     
            <label for="price">Price:</label>
            <select id="Price" name="Price"></select>     
            <label for="buildYear">BuildYear:</label>
            <select id="BuildYear" name="BuildYear"></select> 
            <label for="kilometersDriven">KilometersDriven:</label>
            <select id="KilometersDriven" name="KilometersDriven"></select> 
            
           
            
    
            <!-- Add more filter fields as needed -->
    
            <button type="submit" id="applyButton">Apply Filters</button>
            <button type="submit" id="ClearButton">Clear Filters</button>
        </form>
    
        <h1>Available list of cars</h1>
        <ul id="items-list"></ul>
        
        <div id="carListContainer">
            <ul id="carList"></ul>
        </div> 
            

        
       
    </main>

    <footer>
        <script>
            
            document.addEventListener("DOMContentLoaded", function() {
                const toggleFormBtn = document.getElementById("toggle-form-btn");
                const signupLoginForm = document.getElementById("signup-login-form");
        
                toggleFormBtn.addEventListener("click", function() {
                    signupLoginForm.classList.toggle("hidden");
                });
            });
        </script>
        
        <p>&copy; 2024 Used Car Portal</p>
    </footer>

    <script src="frontend-app.js"></script>
</body>
</html>
